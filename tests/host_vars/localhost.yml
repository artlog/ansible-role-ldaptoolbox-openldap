# Configuration openldap
# ----------------------

ldaptoolbox_openldap_custom_schema_srcdir: "{{ playbook_dir }}/files/ldaptoolbox.oldap/usr/local/openldap/etc/openldap/schema"
ldaptoolbox_openldap_custom_schema_list:
  - custom.ldif

ldaptoolbox_openldap_olcSaslHost: 127.0.0.1
ldaptoolbox_openldap_olcSortVals: member
ldaptoolbox_openldap_olcServerID: 1
ldaptoolbox_openldap_olcTLSCACertificateFile: /etc/ssl/certs/ca-certificates.crt
ldaptoolbox_openldap_olcTLSCertificateFile: /etc/ssl/certs/ssl-cert-snakeoil.pem
ldaptoolbox_openldap_olcTLSCertificateKeyFile: /etc/ssl/private/ssl-cert-snakeoil.key
ldaptoolbox_openldap_olcTLSProtocolMin: 3.3
ldaptoolbox_openldap_olcLogLevel: stats

ldaptoolbox_openldap_config_olcRootDN: cn=admin,cn=config
ldaptoolbox_openldap_config_olcRootPW_hash: "{{ ldaptoolbox_openldap_config_olcRootPW_hash_vault }}"
ldaptoolbox_openldap_database_olcRootDN: cn=admin,dc=my-domain,dc=com
ldaptoolbox_openldap_database_olcRootPW_hash: "{{ ldaptoolbox_openldap_database_olcRootPW_hash_vault }}"

ldaptoolbox_openldap_suffix: "dc=my-domain,dc=com"

ldaptoolbox_openldap_syncrepl:
- rid: "001"
  provider: "ldap://localhost:389/"
  tlscert: "{{ ldaptoolbox_openldap_olcTLSCertificateFile }}"
  tlskey: "{{ ldaptoolbox_openldap_olcTLSCertificateKeyFile }}"
  tlscacert: "{{ ldaptoolbox_openldap_olcTLSCACertificateFile }}"
  tlsreqcert: "demand"
  binddn: "uid=syncrepl,ou=accounts,ou=infrastructure,dc=my-domain,dc=com"
  password: "{{ ldaptoolbox_openldap_syncrepl_password_vault }}"
  searchbase: "{{ ldaptoolbox_openldap_suffix }}"
  scope: "sub"
  type: "refreshAndPersist"
  retry: "5 5 300 +"
- rid: "002"
  provider: "ldap://localhost:389/"
  tlscert: "{{ ldaptoolbox_openldap_olcTLSCertificateFile }}"
  tlskey: "{{ ldaptoolbox_openldap_olcTLSCertificateKeyFile }}"
  tlscacert: "{{ ldaptoolbox_openldap_olcTLSCACertificateFile }}"
  tlsreqcert: "demand"
  binddn: "uid=syncrepl,ou=accounts,ou=infrastructure,dc=my-domain,dc=com"
  password: "{{ ldaptoolbox_openldap_syncrepl_password_vault }}"
  searchbase: "{{ ldaptoolbox_openldap_suffix }}"
  scope: "sub"
  type: "refreshAndPersist"
  retry: "5 5 300 +"

ldaptoolbox_openldap_access_list:
  - to * by dn.exact=gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth manage by * break
  - to dn.base="" by * read
  - to dn.base="cn=Subschema" by * read
  - to * by self write  by users read  by anonymous auth

ldaptoolbox_openldap_database_olcLimits:
  - dn.base="uid=syncrepl,ou=accounts,ou=infrastructure,dc=my-domain,dc=com" size=unlimited  time=unlimited

ldaptoolbox_openldap_database_olcDbIndexes:
  - "objectClass eq"
  - "entryUUID eq"
  - "entryCSN eq"
  - "cn pres,eq,sub"
  - "uid pres,eq,sub"

ldaptoolbox_openldap_database_olcDbMaxSize: "4294967296"

ldaptoolbox_openldap_overlay_syncprov_olcSpCheckpoint: "100 10"
ldaptoolbox_openldap_overlay_syncprov_olcSpSessionlog: "100"

ldaptoolbox_openldap_overlay_ppolicy_olcPPolicyDefault: "cn=default,ou=ppolicies,dc=my-domain,dc=com"
ldaptoolbox_openldap_overlay_ppolicy_olcPPolicyHashCleartext: "TRUE"
ldaptoolbox_openldap_overlay_ppolicy_olcPPolicyUseLockout: "TRUE"

ldaptoolbox_openldap_overlay_refint_olcRefintAttribute: "member"
ldaptoolbox_openldap_overlay_refint_olcRefintNothing: "cn=nothing,dc=my-domain,dc=com"

ldaptoolbox_openldap_overlay_dynlist_olcDlAttrSet: "groupOfURLs memberURL member+memberOf@groupOfNames*"

ldaptoolbox_openldap_monitor_olcRootDN: "cn=monitor"
ldaptoolbox_openldap_monitor_olcRootPW_hash: "{{ ldaptoolbox_openldap_monitor_olcRootPW_hash_vault }}"

